<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Body Marker – MVP (simple)</title>
  <style>
    :root{ --bg:#0b1220; --ink:#e5e7eb; --muted:#9ca3af; --panel:#111827; --btn:#1f2937; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink);padding:16px}
    header{max-width:760px;margin:0 auto 12px;display:flex;justify-content:space-between;align-items:center}
    h1{font-size:18px;margin:0}
    .app{max-width:760px;margin:0 auto;display:grid;grid-template-columns:1fr 240px;gap:12px}
    .card{background:var(--panel);border:1px solid #1f2937;border-radius:12px;padding:12px}
    .stage{position:relative;aspect-ratio:3/5;width:100%;border-radius:8px;overflow:hidden;background:#0a1426}
    .figure{position:absolute;inset:0;width:100%;height:100%;object-fit:contain}
    svg#overlay{position:absolute;inset:0;width:100%;height:100%;cursor:crosshair}
    button,input[type=file]{background:var(--btn);color:var(--ink);border:1px solid #334155;border-radius:10px;padding:8px 10px}
    button:hover{filter:brightness(1.08)}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Body Marker – MVP</h1>
    <span class="small">Click = agregar punto · Doble‑click = borrar punto cercano</span>
  </header>

  <div class="app">
    <section class="card">
      <div class="stage" id="stage">
        <img class="figure" src="https://jdelafuentec.github.io/web/ayudantias/humano.png" alt="humano"/>
        <!-- Capa para puntos -->
        <svg id="overlay" viewBox="0 0 100 160" xmlns="http://www.w3.org/2000/svg"></svg>
      </div>
    </section>

    <aside class="card">
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="clear">Limpiar</button>
        <button id="export">Exportar JSON</button>
        <label>Importar <input id="import" type="file" accept="application/json"></label>
      </div>
      <p class="small" id="count" style="margin-top:10px">0 puntos</p>
      <p class="small">Este MVP sólo marca puntos y permite exportar/importar. Si luego quieres, añadimos clustering y perfil.</p>
    </aside>
  </div>

  <script>
    const overlay = document.getElementById('overlay');
    const countEl = document.getElementById('count');
    const state = { points: [] }; // puntos normalizados (0..1)

    function dist(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy); }

    function redraw(){
      overlay.innerHTML = '';
      state.points.forEach(p => {
        const cx = p.x * 100, cy = p.y * 160;
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('cx', cx); c.setAttribute('cy', cy); c.setAttribute('r', 2.2);
        c.setAttribute('fill', '#fb7185'); // rojo suave
        c.setAttribute('stroke', '#111827'); c.setAttribute('stroke-width', '0.6');
        overlay.appendChild(c);
      });
      countEl.textContent = `${state.points.length} punto${state.points.length===1?'':'s'}`;
    }

    function clientToNorm(e){
      const rect = overlay.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = (e.clientY - rect.top) / rect.height;
      // clamp por si acaso
      return { x: Math.min(1, Math.max(0, x)), y: Math.min(1, Math.max(0, y)) };
    }

    overlay.addEventListener('click', (e)=>{
      const p = clientToNorm(e);
      state.points.push(p);
      redraw();
    });

    overlay.addEventListener('dblclick', (e)=>{
      e.preventDefault(); if(!state.points.length) return;
      const p = clientToNorm(e);
      let best=-1, bestD=Infinity;
      state.points.forEach((q,i)=>{ const d=dist(q,p); if(d<bestD){bestD=d; best=i;} });
      if(best>=0){ state.points.splice(best,1); redraw(); }
    });

    document.getElementById('clear').addEventListener('click', ()=>{ state.points=[]; redraw(); });

    document.getElementById('export').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify({points:state.points}, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'molestias.json'; a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('import').addEventListener('change', (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      const r = new FileReader();
      r.onload = ()=>{ try{ const o = JSON.parse(r.result); if(Array.isArray(o.points)){ state.points = o.points.map(p=>({x:+p.x,y:+p.y})); redraw(); } } catch{ alert('JSON inválido'); } };
      r.readAsText(f);
    });

    redraw();
  </script>
</body>
</html>
