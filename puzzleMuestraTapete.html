<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puzzle - Rupestre la Puma</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            background-color: #ffffff; 
            color: #333; 
            padding: 10px;
            margin: 0;
            /* Evita que la pantalla rebote en móviles */
            overscroll-behavior: none;
        }
        
        h1 { font-size: 1.4rem; margin: 15px 0; color: #2c3e50; }

        #contenedor-juego { 
            margin: 10px auto; 
            width: fit-content; 
            /* Evita que el dedo mueva la página al tocar el puzzle */
            touch-action: none; 
        }

        #tablero {
            display: grid;
            grid-template-columns: repeat(4, 75px);
            grid-template-rows: repeat(4, 75px);
            gap: 4px;
            background-color: #eee;
            border: 2px solid #333;
            margin: 0 auto;
        }

        /* Ajuste para pantallas más grandes (PC/Tablets) */
        @media (min-width: 450px) {
            #tablero {
                grid-template-columns: repeat(4, 110px);
                grid-template-rows: repeat(4, 110px);
            }
            .pieza { width: 110px !important; height: 110px !important; }
            #imagen-final { width: 452px !important; height: 452px !important; }
        }

        .pieza {
            width: 75px;
            height: 75px;
            background-size: cover;
            cursor: pointer;
            border-radius: 3px;
            /* Mejora el rendimiento táctil */
            -webkit-tap-highlight-color: transparent;
        }

        .seleccionada {
            outline: 4px solid #d35400;
            box-shadow: 0 0 15px rgba(211, 84, 0, 0.5);
            z-index: 10;
        }

        #imagen-final {
            display: none;
            width: 312px;
            height: 312px;
            border: 4px solid #d35400;
            margin: 0 auto;
            border-radius: 8px;
        }

        #contenedor-mensaje {
            display: none;
            margin-top: 20px;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 30px;
        }

        #texto-info {
            line-height: 1.6;
            font-size: 0.95em;
            color: #444;
            text-align: justify;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }

        .btn-reiniciar {
            margin-top: 20px;
            padding: 15px 30px;
            background-color: #d35400;
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1em;
            width: 80%; /* Botón grande para tocar fácil en móvil */
        }

        .instrucciones { color: #888; font-size: 0.85em; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>Puzzle: Rupestre</h1>
    <p id="instrucciones" class="instrucciones">Toca una pieza y luego una vecina para moverla.</p>

    <div id="contenedor-juego">
        <div id="tablero"></div>
        <img id="imagen-final" src="https://jdelafuentec.github.io/web/piezas_rupestre/original_rupestre.jpg">
    </div>

    <div id="contenedor-mensaje">
        <div id="texto-info">
            Rupestre fue una legendaria hembra de puma del Parque Nacional Torres del Paine que se convirtió en un ícono mundial de la vida silvestre tras protagonizar documentales de Netflix y la BBC. Conocida como la "Reina de la Patagonia", vivió aproximadamente 14 años —una edad excepcional para su especie— y destacó por ser una madre prolífica que dejó un linaje clave para la conservación en la región. Su reciente fallecimiento en enero de 2026, ocurrido por causas naturales, marca el fin de una era para el rastreo de pumas, dejando un legado invaluable sobre el comportamiento y la belleza de estos felinos en el extremo sur de Chile.<br><br>
            <strong>Foto: Nicolás Lagos.</strong>
        </div>
        <button class="btn-reiniciar" onclick="iniciarPuzzle()">Jugar de nuevo</button>
    </div>

    <script>
        const tablero = document.getElementById('tablero');
        const imgFinal = document.getElementById('imagen-final');
        const mensaje = document.getElementById('contenedor-mensaje');
        const instrucc = document.getElementById('instrucciones');
        const BASE_URL = "https://jdelafuentec.github.io/web/piezas_rupestre/";
        
        let piezaSeleccionada = null;

        function iniciarPuzzle() {
            tablero.innerHTML = '';
            tablero.style.display = 'grid';
            imgFinal.style.display = 'none';
            mensaje.style.display = 'none';
            instrucc.style.display = 'block';
            piezaSeleccionada = null;

            let piezas = [];
            for (let f = 0; f < 4; f++) {
                for (let c = 0; c < 4; c++) {
                    piezas.push({ f, c });
                }
            }

            piezas.sort(() => Math.random() - 0.5);

            piezas.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = 'pieza';
                div.style.backgroundImage = `url('${BASE_URL}pieza_rupestre_${p.f}_${p.c}.png')`;
                div.dataset.id = `pieza_rupestre_${p.f}_${p.c}`;
                div.dataset.idx = index; 

                // Evento unificado: funciona en móvil y PC
                div.addEventListener('click', manejarToque);
                
                tablero.appendChild(div);
            });
        }

        function manejarToque() {
            if (!piezaSeleccionada) {
                piezaSeleccionada = this;
                this.classList.add('seleccionada');
            } else {
                if (this === piezaSeleccionada) {
                    this.classList.remove('seleccionada');
                    piezaSeleccionada = null;
                } else if (sonVecinas(piezaSeleccionada, this)) {
                    intercambiar(piezaSeleccionada, this);
                    piezaSeleccionada.classList.remove('seleccionada');
                    piezaSeleccionada = null;
                } else {
                    // Si toca una no vecina, cambiamos la selección
                    piezaSeleccionada.classList.remove('seleccionada');
                    piezaSeleccionada = this;
                    this.classList.add('seleccionada');
                }
            }
        }

        function sonVecinas(p1, p2) {
            const i1 = parseInt(p1.dataset.idx);
            const i2 = parseInt(p2.dataset.idx);
            const r1 = Math.floor(i1 / 4), c1 = i1 % 4;
            const r2 = Math.floor(i2 / 4), c2 = i2 % 4;
            return (Math.abs(r1 - r2) === 1 && c1 === c2) || (Math.abs(c1 - c2) === 1 && r1 === r2);
        }

        function intercambiar(p1, p2) {
            const imgTmp = p2.style.backgroundImage;
            const idTmp = p2.dataset.id;
            p2.style.backgroundImage = p1.style.backgroundImage;
            p2.dataset.id = p1.dataset.id;
            p1.style.backgroundImage = imgTmp;
            p1.dataset.id = idTmp;
            verificarVictoria();
        }

        function verificarVictoria() {
            const actuales = document.querySelectorAll('.pieza');
            let aciertos = 0;
            actuales.forEach((p, i) => {
                const f = Math.floor(i / 4);
                const c = i % 4;
                if (p.dataset.id === `pieza_rupestre_${f}_${c}`) aciertos++;
            });

            if (aciertos === 16) {
                tablero.style.display = 'none';
                instrucc.style.display = 'none';
                imgFinal.style.display = 'block';
                mensaje.style.display = 'block';
                window.scrollTo(0,0); // Sube la pantalla para ver la foto
            }
        }

        iniciarPuzzle();
    </script>
</body>
</html>
