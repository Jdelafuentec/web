<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puzzle - Rupestre la Puma</title>
    <style>
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            text-align: center; 
            background-color: #ffffff; 
            color: #333; 
            padding: 10px;
            margin: 0;
            overscroll-behavior-y: contain;
        }
        
        h1 { margin-top: 20px; color: #2c3e50; }

        #contenedor-juego { 
            margin: 20px auto; 
            width: fit-content; 
        }

        #tablero {
            display: grid;
            grid-template-columns: repeat(4, 80px);
            grid-template-rows: repeat(4, 80px);
            gap: 4px;
            background-color: #f2f2f2;
            border: 3px solid #333;
            margin: 0 auto;
        }

        @media (min-width: 500px) {
            #tablero {
                grid-template-columns: repeat(4, 120px);
                grid-template-rows: repeat(4, 120px);
            }
            .pieza { width: 120px !important; height: 120px !important; }
            #imagen-final { width: 492px !important; height: 492px !important; }
        }

        .pieza {
            width: 80px;
            height: 80px;
            background-size: cover;
            cursor: pointer;
            border-radius: 4px;
            transition: transform 0.1s, outline 0.1s;
        }

        /* Resalte para la pieza seleccionada */
        .seleccionada {
            outline: 5px solid #d35400 !important;
            transform: scale(1.02);
            z-index: 10;
        }

        /* Foto original que aparece al ganar */
        #imagen-final {
            display: none;
            width: 332px;
            height: 332px;
            border: 5px solid #d35400;
            margin: 0 auto;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        #contenedor-mensaje {
            display: none;
            margin-top: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            padding: 20px;
            background-color: #fdfdfd;
            border-top: 5px solid #d35400;
            border-radius: 0 0 10px 10px;
        }

        #texto-info {
            line-height: 1.7;
            font-size: 1.05em;
            color: #444;
            text-align: justify;
        }

        .btn-reiniciar {
            margin-top: 20px;
            padding: 12px 30px;
            background-color: #d35400;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }

        .btn-reiniciar:hover { background-color: #a04000; }

        .instrucciones { color: #888; font-style: italic; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>Arma el puzzle para conocer a Rupestre</h1>
    <p id="instrucciones" class="instrucciones">Toca una pieza y luego una vecina para intercambiarlas.</p>

    <div id="contenedor-juego">
        <div id="tablero"></div>
        <img id="imagen-final" src="https://jdelafuentec.github.io/web/piezas_rupestre/original_rupestre.jpg">
    </div>

    <div id="contenedor-mensaje">
        <div id="texto-info">
            Rupestre fue una legendaria hembra de puma del Parque Nacional Torres del Paine que se convirtió en un ícono mundial de la vida silvestre tras protagonizar documentales de Netflix y la BBC. Conocida como la "Reina de la Patagonia", vivió aproximadamente 14 años —una edad excepcional para su especie— y destacó por ser una madre prolífica que dejó un linaje clave para la conservación en la región. Su reciente fallecimiento en enero de 2026, ocurrido por causas naturales, marca el fin de una era para el rastreo de pumas, dejando un legado invaluable sobre el comportamiento y la belleza de estos felinos en el extremo sur de Chile.<br><br>
            <strong>Foto: Nicolás Lagos.</strong>
        </div>
        <button class="btn-reiniciar" onclick="iniciarPuzzle()">Reiniciar Puzzle</button>
    </div>

    <script>
        const tablero = document.getElementById('tablero');
        const imgFinal = document.getElementById('imagen-final');
        const mensaje = document.getElementById('contenedor-mensaje');
        const instrucc = document.getElementById('instrucciones');
        const BASE_URL = "https://jdelafuentec.github.io/web/piezas_rupestre/";
        
        let piezaSeleccionada = null;

        function iniciarPuzzle() {
            // Reiniciar visibilidad de elementos
            tablero.innerHTML = '';
            tablero.style.display = 'grid';
            imgFinal.style.display = 'none';
            mensaje.style.display = 'none';
            instrucc.style.display = 'block';

            let piezas = [];
            for (let f = 0; f < 4; f++) {
                for (let c = 0; c < 4; c++) {
                    piezas.push({ f, c });
                }
            }

            // Mezclar
            piezas.sort(() => Math.random() - 0.5);

            piezas.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = 'pieza';
                div.style.backgroundImage = `url('${BASE_URL}pieza_rupestre_${p.f}_${p.c}.png')`;
                
                div.dataset.identidad = `pieza_rupestre_${p.f}_${p.c}`;
                div.dataset.indice = index; 

                // Evento de toque/click
                div.addEventListener('click', seleccionar);
                
                tablero.appendChild(div);
            });
        }

        function seleccionar() {
            if (!piezaSeleccionada) {
                piezaSeleccionada = this;
                this.classList.add('seleccionada');
            } else {
                if (this === piezaSeleccionada) {
                    this.classList.remove('seleccionada');
                    piezaSeleccionada = null;
                    return;
                }

                if (esVecina(piezaSeleccionada, this)) {
                    intercambiar(piezaSeleccionada, this);
                }
                
                piezaSeleccionada.classList.remove('seleccionada');
                piezaSeleccionada = null;
            }
        }

        function esVecina(p1, p2) {
            const i1 = parseInt(p1.dataset.indice);
            const i2 = parseInt(p2.dataset.indice);

            const r1 = Math.floor(i1 / 4), c1 = i1 % 4;
            const r2 = Math.floor(i2 / 4), c2 = i2 % 4;

            return (Math.abs(r1 - r2) === 1 && c1 === c2) || (Math.abs(c1 - c2) === 1 && r1 === r2);
        }

        function intercambiar(p1, p2) {
            const imgTmp = p2.style.backgroundImage;
            const idTmp = p2.dataset.identidad;

            p2.style.backgroundImage = p1.style.backgroundImage;
            p2.dataset.identidad = p1.dataset.identidad;

            p1.style.backgroundImage = imgTmp;
            p1.dataset.identidad = idTmp;

            chequearVictoria();
        }

        function chequearVictoria() {
            const piezasActuales = document.querySelectorAll('.pieza');
            let aciertos = 0;
            piezasActuales.forEach((p, i) => {
                const fila = Math.floor(i / 4);
                const col = i % 4;
                if (p.dataset.identidad === `pieza_rupestre_${fila}_${col}`) {
                    aciertos++;
                }
            });

            if (aciertos === 16) {
                // Al completar el puzzle, ocultamos piezas y mostramos original + info
                tablero.style.display = 'none';
                instrucc.style.display = 'none';
                imgFinal.style.display = 'block';
                mensaje.style.display = 'block';
            }
        }

        iniciarPuzzle();
    </script>
</body>
</html>
