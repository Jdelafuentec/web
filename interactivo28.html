<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Geo Interactivo – Maricunga (con Vegetación + QR)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js"></script>
  <style>
    html, body { margin: 0; padding: 0; background:#fff; font-family: Arial, sans-serif; }
    main { min-height: 100vh; display: grid; place-items: center; padding: 16px; }
    .block { display: flex; flex-direction: column; align-items: flex-start; gap: 12px; }
    .logo { width: 520px; height: auto; display: block; }
    canvas { box-shadow: 0 10px 30px rgba(0,0,0,.08); border-radius: 12px; }
  </style>
</head>
<body>
  <main>
    <div class="block">
      <img class="logo" src="https://jdelafuentec.github.io/web/OA_Recurso48.png" alt="OASIS">
      <div id="canvas-holder"></div>
    </div>
  </main>

  <script>
    const S = 1.0;
    const W = 1275 * S, H = 768 * S;
    const BASE = 'https://jdelafuentec.github.io/web/geo_interactivo/';

    let etapa = 0;
    let subVolcan = 1;

    let fondoBlanco, montanas;
    let nubeImg, lluviaImg, aguaRioImg, infiltradaImg;
    let flechaAgua1, flechaAgua2, flechaAgua3, flechaAgua4;
    let flechaAgua2_1, flechaAgua2_2, flechaAgua2_3;
    let flechaRios;
    let volcanesImg, rocasVolcanicasImg, flechaMagma, flechaMagma2, lavaImg;
    let lagunaStaRosaImg, vegetacionImg, gravaImg, solImg;

    let capas = [];
    let capaActiva = null;
    let mostrarCapaTemporal = false;

    let lluviaActiva = false;
    let lluviaInicio = 0;

    const ZONA_SALAR = { x: 520*S, y: 320*S, w: 420*S, h: 220*S };

    const POS = {
      volcanes: {x:642*S,y:220*S},
      vegetacion: {x:110*S,y:356*S},
      lagunaStaRosa: {x:114*S,y:453*S},
      rocasVolcanicas: {x:587*S,y:245*S},
      grava: {x:337*S,y:304*S},
      AguaInfiltrada: {x:432*S,y:255*S},
      nube: {x:528*S,y:46*S},
      lluvia: {x:579*S,y:140*S},
      flechaMagma: {x:781*S,y:356*S},
      flechaMagma2: {x:728*S,y:281*S},
      carbonatos: {x:138*S,y:342*S},
      travertines: {x:436*S,y:269*S},
      sulphates: {x:233*S,y:330*S},
      halite: {x:251*S,y:327*S},
      flechaAgua4: {x:594*S,y:315*S},
      flechaAgua1: {x:568*S,y:356*S},
      flechaAgua2: {x:670*S,y:308*S},
      flechaAgua3: {x:638*S,y:376*S},
      flechaAgua2_1: {x:822*S,y:273*S},
      flechaAgua2_3: {x:868*S,y:311*S},
      flechaAgua2_2: {x:865*S,y:238*S},
      lava: {x:693*S,y:393*S},
      aguaRio: {x:419*S,y:265*S},
      flechaRios: {x:25*S,y:336*S}
    };

    let POS_SOL = { x: POS.nube.x - 140, y: POS.nube.y - 60 };

    function preload() {
      fondoBlanco = loadImage(BASE + 'fondoBlanco.png');
      montanas    = loadImage(BASE + 'montanas.png');
      nubeImg     = loadImage(BASE + 'nube.png');
      lluviaImg   = loadImage(BASE + 'lluvia.png');
      aguaRioImg  = loadImage(BASE + 'aguaRio.png');
      infiltradaImg = loadImage(BASE + 'AguaInfiltrada.png');
      flechaAgua1   = loadImage(BASE + 'flechaAgua1.png');
      flechaAgua2   = loadImage(BASE + 'flechaAgua2.png');
      flechaAgua3   = loadImage(BASE + 'flechaAgua3.png');
      flechaAgua4   = loadImage(BASE + 'flechaAgua4.png');
      flechaAgua2_1 = loadImage(BASE + 'flechaAgua2_1.png');
      flechaAgua2_2 = loadImage(BASE + 'flechaAgua2_2.png');
      flechaAgua2_3 = loadImage(BASE + 'flechaAgua2_3.png');
      flechaRios    = loadImage(BASE + 'flechaRios.png');
      volcanesImg        = loadImage(BASE + 'volcanes.png');
      rocasVolcanicasImg = loadImage(BASE + 'rocasVolcanicas.png');
      flechaMagma        = loadImage(BASE + 'flechaMagma.png');
      flechaMagma2       = loadImage(BASE + 'flechaMagma2.png');
      lavaImg            = loadImage(BASE + 'lava.png');
      lagunaStaRosaImg = loadImage(BASE + 'lagunaStaRosa.png');
      vegetacionImg    = loadImage(BASE + 'vegetacion.png');
      gravaImg         = loadImage(BASE + 'grava.png');
      solImg           = loadImage(BASE + 'sol.png');

      capas.push({
        nombre:"Sulfatos",
        descripcion:"Los sulfatos como el yeso (CaSO₄·2H₂O) se forman en etapas intermedias de evaporación.",
        img: loadImage(BASE+'sulphates.png'),
        imagenEjemplo: loadImage('https://picsum.photos/seed/sulphates/80'),
        x:POS.sulphates.x,y:POS.sulphates.y
      });
      capas.push({
        nombre:"Travertinos",
        descripcion:"Roca sedimentaria carbonatada, compuesta principalmente de calcita (CaCO₃), formada por precipitación química y orgánica en aguas termales.",
        img: loadImage(BASE+'travertines.png'),
        imagenEjemplo: loadImage(BASE+'travertinoImg.png'),
        x:POS.travertines.x,y:POS.travertines.y
      });
      capas.push({
        nombre:"Cloruros",
        descripcion:"Los cloruros como la halita (NaCl) precipitan en etapas finales de evaporación. Se concentran en zonas centrales de los salares.",
        img: loadImage(BASE+'halite.png'),
        imagenEjemplo: loadImage('https://picsum.photos/seed/halite/80'),
        x:POS.halite.x,y:POS.halite.y
      });
      capas.push({
        nombre:"Carbonatos",
        descripcion:"Los carbonatos como la calcita (CaCO₃) se precipitan cuando hay pérdida de CO₂ en aguas ricas en calcio. Se concentran en zonas periféricas de los salares.",
        img: loadImage(BASE+'carbonatos.png'),
        imagenEjemplo: loadImage(BASE+'carbonatoImg.png'),
        x:POS.carbonatos.x,y:POS.carbonatos.y
      });
      capas.push({
        nombre:"Vegetación",
        descripcion:"Cobertura vegetal en bordes y humedales. Indica presencia de agua y procesos biológicos asociados.",
        img: loadImage(BASE+'vegetacion.png'),
        imagenEjemplo: loadImage(BASE+'qrHerbario.png'),
        x:POS.vegetacion.x,y:POS.vegetacion.y
      });
    }

    // setup, draw, mousePressed, utils, labels iguales que tu base...
    // SOLO cambia mostrarConsola() para usar tus textos 1–7.

    function setup(){const c=createCanvas(W,H);c.parent(document.querySelector('#canvas-holder'));textFont('Arial');textSize(16*S);noStroke();}
    function draw(){background(255);image(fondoBlanco,0,0);image(montanas,0,192);image(solImg,POS_SOL.x,POS_SOL.y);image(nubeImg,POS.nube.x,POS.nube.y);
      if(etapa===0||lluviaActiva){if(lluviaActiva){const elapsed=millis()-lluviaInicio;if(elapsed<2000){const offset=map(elapsed,0,2000,0,60*S);
      image(lluviaImg,POS.lluvia.x,POS.lluvia.y+offset);}else{lluviaActiva=false;etapa=1;}}}
      if(etapa===1){image(aguaRioImg,POS.aguaRio.x,POS.aguaRio.y);}
      if(etapa===2){image(infiltradaImg,POS.AguaInfiltrada.x,POS.AguaInfiltrada.y);}
      if(etapa===3){if(subVolcan>=1)image(volcanesImg,POS.volcanes.x,POS.volcanes.y);}
      if(etapa===4){image(vegetacionImg,POS.vegetacion.x,POS.vegetacion.y);image(lagunaStaRosaImg,POS.lagunaStaRosa.x,POS.lagunaStaRosa.y);}
      if(etapa===6){for(let capa of capas){image(capa.img,capa.x,capa.y);} }
      mostrarConsola();
    }
    function mousePressed(){if(hit(POS.nube,nubeImg)){etapa=0;subVolcan=1;lluviaActiva=true;lluviaInicio=millis();return;}}

    function mostrarConsola(){
      const alto=230*S,yBase=H-alto-530*S;
      fill(255);stroke(0);rect(10*S,yBase,520*S,alto);noStroke();fill(0);textSize(12*S);
      if(etapa===0) narr("1- Precipitaciones de aguas y nieve, desarrollo de sistemas hídricos",yBase,12*S);
      else if(etapa===1) narr("2- Acumulación y derretimiento de nieve",yBase,12*S);
      else if(etapa===2) narr("3- Infiltración y calentamiento de aguas en la tierra",yBase,12*S);
      else if(etapa===3) narr("4- Surgencias de aguas termales y creación de los travertinos",yBase,12*S);
      else if(etapa===4) narr("5- Recarga hídrica de Cuenca de Maricunga",yBase,12*S);
      else if(etapa===5) narr("6- Altas tasas de evaporación y formación de costras minerales",yBase,12*S);
      else if(etapa===6) narr("Explora los elementos: Travertinos, Carbonatos, Sulfatos, Cloruros y Vegetación",yBase,12*S);
      else if(etapa===7) narr("7- Evolución química de salmueras enriquecidas en litio, potasio y tierras raras",yBase,12*S);
    }
    function narr(msg,yBase,fs){textSize(fs);text(msg,20*S,yBase+40*S,480*S);}
    function hit(pos,img){return mouseX>=pos.x&&mouseX<pos.x+img.width&&mouseY>=pos.y&&mouseY<img.height+pos.y;}
  </script>
</body>
</html>
