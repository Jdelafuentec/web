<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Contador de Precisión - Patagonia</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #1a1a1a; color: #ccc; margin: 0; padding: 20px; }
        
        .controls { background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; border: 1px solid #444; }
        
        #canvas-container { position: relative; cursor: crosshair; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        
        canvas { max-width: 100%; height: auto; display: block; }

        /* Cruz ultra fina y pequeña */
        .marker {
            position: absolute;
            width: 6px;  /* Tamaño reducido */
            height: 6px;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .marker::before, .marker::after {
            content: '';
            position: absolute;
            background: #00ff00; /* Verde neón para resaltar */
        }

        /* Línea horizontal ultra fina */
        .marker::before {
            top: 50%;
            left: 0;
            width: 100%;
            height: 0.5px; /* Grosor mínimo */
        }

        /* Línea vertical ultra fina */
        .marker::after {
            left: 50%;
            top: 0;
            width: 0.5px; /* Grosor mínimo */
            height: 100%;
        }

        #counter { font-size: 18px; font-weight: bold; color: #00ff00; border: 1px solid #00ff00; padding: 5px 12px; border-radius: 4px; }
        
        button { background: #444; border: 1px solid #666; padding: 8px 15px; color: white; border-radius: 4px; cursor: pointer; }
        button:hover { background: #555; }
    </style>
</head>
<body>

    <div class="controls">
        <input type="file" id="upload" accept="image/*">
        <div id="counter">Pingüinos: 0</div>
        <button onclick="exportData()">Exportar CSV</button>
        <button onclick="resetCanvas()">Limpiar</button>
    </div>

    <div id="canvas-container">
        <canvas id="penguinCanvas"></canvas>
    </div>

    <script>
        const upload = document.getElementById('upload');
        const canvas = document.getElementById('penguinCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvas-container');
        const counterDisplay = document.getElementById('counter');
        
        let penguinData = [];
        let img = new Image();

        upload.addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = (event) => {
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    resetData();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        canvas.addEventListener('click', (e) => {
            if (!img.src) return;

            const rect = canvas.getBoundingClientRect();
            const visualX = e.clientX - rect.left;
            const visualY = e.clientY - rect.top;

            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            penguinData.push({ 
                x: (visualX * scaleX).toFixed(2), 
                y: (visualY * scaleY).toFixed(2) 
            });
            
            const marker = document.createElement('div');
            marker.className = 'marker';
            marker.style.left = visualX + 'px';
            marker.style.top = visualY + 'px';
            container.appendChild(marker);

            counterDisplay.innerText = `Pingüinos: ${penguinData.length}`;
        });

        function resetData() {
            penguinData = [];
            counterDisplay.innerText = `Pingüinos: 0`;
            document.querySelectorAll('.marker').forEach(m => m.remove());
        }

        function resetCanvas() {
            if (img.src) ctx.drawImage(img, 0, 0);
            resetData();
        }

        function exportData() {
            if (penguinData.length === 0) return;
            let csvContent = "data:text/csv;charset=utf-8,ID,X,Y\n" 
                + penguinData.map((p, i) => `${i+1},${p.x},${p.y}`).join("\n");
            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", "monitoreo_pinguinos.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
